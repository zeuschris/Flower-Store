---
interface Props {
  animation?: 'fade-up' | 'fade-down' | 'fade-left' | 'fade-right' | 'scale' | 'rotate';
  delay?: number;
  duration?: number;
  class?: string;
}

const { 
  animation = 'fade-up', 
  delay = 0, 
  duration = 600,
  class: className = '' 
} = Astro.props;
---

<div 
  class={`scroll-reveal scroll-reveal-${animation} ${className}`}
  data-delay={delay}
  data-duration={duration}
>
  <slot />
</div>

<style>
  .scroll-reveal {
    opacity: 0;
    transition-property: opacity, transform;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }

  .scroll-reveal-fade-up {
    transform: translateY(40px);
  }

  .scroll-reveal-fade-down {
    transform: translateY(-40px);
  }

  .scroll-reveal-fade-left {
    transform: translateX(40px);
  }

  .scroll-reveal-fade-right {
    transform: translateX(-40px);
  }

  .scroll-reveal-scale {
    transform: scale(0.9);
  }

  .scroll-reveal-rotate {
    transform: rotate(-5deg) scale(0.95);
  }

  .scroll-reveal.revealed {
    opacity: 1;
    transform: translateY(0) translateX(0) scale(1) rotate(0);
  }
</style>

<script>

  function initScrollAnimations() {
    const reveals = document.querySelectorAll('.scroll-reveal');
    
    if (!reveals.length) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const element = entry.target as HTMLElement;
            const delay = parseInt(element.dataset.delay || '0');
            const duration = parseInt(element.dataset.duration || '600');
            element.style.transitionDuration = `${duration}ms`;
            
            setTimeout(() => {
              element.classList.add('revealed');
            }, delay);
            
            observer.unobserve(element);
          }
        });
      },
      {
        threshold: 0.1, 
        rootMargin: '0px 0px -50px 0px' 
      }
    );

    reveals.forEach((reveal) => observer.observe(reveal));
  }

  document.addEventListener('DOMContentLoaded', initScrollAnimations);
  document.addEventListener('astro:page-load', initScrollAnimations);
</script>